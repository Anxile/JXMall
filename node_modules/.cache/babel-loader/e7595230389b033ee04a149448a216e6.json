{"ast":null,"code":"import _asyncToGenerator from \"D:/\\u7B54\\u8FA9\\u9879\\u76EE/shangpinhuishop/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _this = this;\n\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\n// 该文件专门用于创建整个应用的路由器\n// 引入vue路由\nimport VueRouter from \"vue-router\";\nimport routers from \"./routers\"; // 重写push和replace\n\nvar originPush = VueRouter.prototype.push;\nvar originReplace = VueRouter.prototype.push;\n\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originPush.call(this, location, resolve, reject);\n  } else {\n    originPush.call(this, location, function () {}, function () {});\n  }\n};\n\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originReplace.call(this, location, resolve, reject);\n  } else {\n    originReplace.call(this, location, function () {}, function () {});\n  }\n};\n\nimport store from \"@/store\"; //创建并暴露一个路由器\n\nvar router = new VueRouter({\n  routes: routers,\n  scrollBehavior: function scrollBehavior(to, from, savedPosion) {\n    //返回的这个y=0，代表的滚动条在最上方\n    return {\n      y: 0\n    };\n  }\n}); //全局守卫：前置守卫（在路由跳转之间进行判断）\n\nrouter.beforeEach( /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(to, from, next) {\n    var token, name, toPath;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            // to and from are both route objects. must call `next`.\n            //获取仓库中的token-----可以确定用户是登录了\n            token = store.state.user.token;\n            name = store.state.user.userInfo.name; //用户登录了\n\n            if (!token) {\n              _context.next = 24;\n              break;\n            }\n\n            if (!(to.path == \"/login\" || to.path == \"/register\")) {\n              _context.next = 7;\n              break;\n            }\n\n            next(\"/home\");\n            _context.next = 22;\n            break;\n\n          case 7:\n            if (!name) {\n              _context.next = 11;\n              break;\n            }\n\n            next();\n            _context.next = 22;\n            break;\n\n          case 11:\n            _context.prev = 11;\n            _context.next = 14;\n            return store.dispatch(\"getUserInfo\");\n\n          case 14:\n            next();\n            _context.next = 22;\n            break;\n\n          case 17:\n            _context.prev = 17;\n            _context.t0 = _context[\"catch\"](11);\n            _context.next = 21;\n            return store.dispatch(\"logout\");\n\n          case 21:\n            // 回到登录页\n            _this.$router.push(\"/login\");\n\n          case 22:\n            _context.next = 26;\n            break;\n\n          case 24:\n            //未登录：不能去交易相关、不能去支付相关【pay|paysuccess】、不能去个人中心\n            //未登录去上面这些路由-----登录\n            toPath = to.path;\n\n            if (toPath.includes(\"/trade\") || toPath.includes(\"/pay\") || toPath.includes(\"/center\")) {\n              //把未登录的时候向去而没有去成的信息，存储于地址栏中【路由】\n              next(\"/login?redirect=\".concat(toPath));\n              console.log(toPath);\n            } else {\n              next();\n            }\n\n          case 26:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[11, 17]]);\n  }));\n\n  return function (_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}());\nexport default router;","map":{"version":3,"sources":["D:/答辩项目/shangpinhuishop/src/router/index.js"],"names":["VueRouter","routers","originPush","prototype","push","originReplace","location","resolve","reject","call","replace","store","router","routes","scrollBehavior","to","from","savedPosion","y","beforeEach","next","token","state","user","name","userInfo","path","dispatch","$router","toPath","includes","console","log"],"mappings":"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","sourcesContent":["// 该文件专门用于创建整个应用的路由器\r\n// 引入vue路由\r\nimport VueRouter from \"vue-router\";\r\nimport routers from \"./routers\";\r\n// 重写push和replace\r\nlet originPush = VueRouter.prototype.push;\r\nlet originReplace = VueRouter.prototype.push;\r\nVueRouter.prototype.push = function(location, resolve, reject) {\r\n    if (resolve && reject) {\r\n        originPush.call(this, location, resolve, reject);\r\n    } else {\r\n        originPush.call(\r\n            this,\r\n            location,\r\n            () => {},\r\n            () => {}\r\n        );\r\n    }\r\n};\r\nVueRouter.prototype.replace = function(location, resolve, reject) {\r\n    if (resolve && reject) {\r\n        originReplace.call(this, location, resolve, reject);\r\n    } else {\r\n        originReplace.call(\r\n            this,\r\n            location,\r\n            () => {},\r\n            () => {}\r\n        );\r\n    }\r\n};\r\nimport store from \"@/store\";\r\n//创建并暴露一个路由器\r\nlet router = new VueRouter({\r\n    routes: routers,\r\n    scrollBehavior(to, from, savedPosion) {\r\n        //返回的这个y=0，代表的滚动条在最上方\r\n        return { y: 0 };\r\n    },\r\n});\r\n//全局守卫：前置守卫（在路由跳转之间进行判断）\r\nrouter.beforeEach(async(to, from, next) => {\r\n    // to and from are both route objects. must call `next`.\r\n    //获取仓库中的token-----可以确定用户是登录了\r\n    let token = store.state.user.token;\r\n    let name = store.state.user.userInfo.name;\r\n    //用户登录了\r\n    if (token) {\r\n        //已经登录而且还想去登录------不行\r\n        if (to.path == \"/login\" || to.path == \"/register\") {\r\n            next(\"/home\");\r\n        } else {\r\n            //已经登陆了,访问的是非登录与注册\r\n            //登录了且拥有用户信息放行\r\n            if (name) {\r\n                next();\r\n            } else {\r\n                //登陆了且没有用户信息\r\n                //在路由跳转之前获取用户信息且放行\r\n                try {\r\n                    //获取用户信息\r\n                    await store.dispatch(\"getUserInfo\");\r\n                    next();\r\n                } catch (error) {\r\n                    //token失效从新登录\r\n                    //清除token\r\n                    await store.dispatch(\"logout\");\r\n                    // 回到登录页\r\n                    this.$router.push(\"/login\");\r\n                }\r\n            }\r\n        }\r\n    } else {\r\n        //未登录：不能去交易相关、不能去支付相关【pay|paysuccess】、不能去个人中心\r\n        //未登录去上面这些路由-----登录\r\n        let toPath = to.path;\r\n        if (toPath.includes(\"/trade\") || toPath.includes(\"/pay\") || toPath.includes(\"/center\")) {\r\n            //把未登录的时候向去而没有去成的信息，存储于地址栏中【路由】\r\n            next(`/login?redirect=${toPath}`);\r\n            console.log(toPath);\r\n        } else {\r\n            next();\r\n        }\r\n    }\r\n});\r\nexport default router;"]},"metadata":{},"sourceType":"module"}